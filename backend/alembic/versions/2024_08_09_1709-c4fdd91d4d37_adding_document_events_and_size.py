"""Adding document events and size

Revision ID: c4fdd91d4d37
Revises: fef3614083d9
Create Date: 2024-08-09 17:09:32.315908+00:00

"""
from typing import Sequence, Union

import sqlalchemy as sa
from alembic import op
from alembic_postgresql_enum import TableReference

# revision identifiers, used by Alembic.
revision: str = 'c4fdd91d4d37'
down_revision: Union[str, None] = 'fef3614083d9'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.sync_enum_values(
        'ops',
        'opseventtype',
        [
            # # BLI Related Events
            "CREATE_BLI",
            "UPDATE_BLI",
            "DELETE_BLI",
            "SEND_BLI_FOR_APPROVAL",

            # Project Related Events
            "CREATE_PROJECT",

            # Agreement Related Events
            'CREATE_NEW_AGREEMENT',
            'UPDATE_AGREEMENT',
            'DELETE_AGREEMENT',

            # Notification Related Events
            "ACKNOWLEDGE_NOTIFICATION",

            # Package Related Events
            "CREATE_BLI_PACKAGE",
            "UPDATE_BLI_PACKAGE",

            # Services Component Related Events
            "CREATE_SERVICES_COMPONENT",
            "UPDATE_SERVICES_COMPONENT",
            "DELETE_SERVICES_COMPONENT",

            # Procurement Acquisition Planning Related Events
            "CREATE_PROCUREMENT_ACQUISITION_PLANNING",
            "UPDATE_PROCUREMENT_ACQUISITION_PLANNING",
            "DELETE_PROCUREMENT_ACQUISITION_PLANNING",

            # Document Related Events
            'CREATE_DOCUMENT',
            'UPDATE_DOCUMENT',

            # Auth Related Events
            "LOGIN_ATTEMPT",
            "LOGOUT",

            # User Related Events
            "GET_USER_DETAILS",
            "CREATE_USER",
            "UPDATE_USER",
            "DEACTIVATE_USER",
        ],
        [
            TableReference(
                table_schema='ops',
                table_name='ops_event',
                column_name='event_type'
            ),
            TableReference(
                table_schema='ops',
                table_name='ops_event_version',
                column_name='event_type'
            )
        ],
        enum_values_to_rename=[]
    )

    # Add document size column
    op.add_column(
        'document',
        sa.Column('document_size', sa.Numeric(precision=10, scale=2), nullable=False)
    )
    op.add_column(
        'document_version',
        sa.Column('document_size', sa.Numeric(precision=10, scale=2), nullable=False)
    )

    # Rename file_name to document_name
    op.alter_column(
        'document',
        'file_name',
        new_column_name='document_name',
        existing_type=sa.VARCHAR(),
        nullable=False
    )
    op.alter_column(
        'document_version',
        'file_name',
        new_column_name='document_name',
        existing_type=sa.VARCHAR(),
        nullable=False
    )

    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.sync_enum_values(
        'ops',
        'opseventtype',
        [
            # # BLI Related Events
            "CREATE_BLI",
            "UPDATE_BLI",
            "DELETE_BLI",
            "SEND_BLI_FOR_APPROVAL",

            # Project Related Events
            "CREATE_PROJECT",

            # Agreement Related Events
            'CREATE_NEW_AGREEMENT',
            'UPDATE_AGREEMENT',
            'DELETE_AGREEMENT',

            # Notification Related Events
            "ACKNOWLEDGE_NOTIFICATION",

            # Package Related Events
            "CREATE_BLI_PACKAGE",
            "UPDATE_BLI_PACKAGE",

            # Services Component Related Events
            "CREATE_SERVICES_COMPONENT",
            "UPDATE_SERVICES_COMPONENT",
            "DELETE_SERVICES_COMPONENT",

            # Procurement Acquisition Planning Related Events
            "CREATE_PROCUREMENT_ACQUISITION_PLANNING",
            "UPDATE_PROCUREMENT_ACQUISITION_PLANNING",
            "DELETE_PROCUREMENT_ACQUISITION_PLANNING",

            # Document Related Events
            'CREATE_DOCUMENT',

            # Auth Related Events
            "LOGIN_ATTEMPT",
            "LOGOUT",

            # User Related Events
            "GET_USER_DETAILS",
            "CREATE_USER",
            "UPDATE_USER",
            "DEACTIVATE_USER",
        ],
        [
            TableReference(
                table_schema='ops',
                table_name='ops_event',
                column_name='event_type'
            ),
            TableReference(
                table_schema='ops',
                table_name='ops_event_version',
                column_name='event_type'
            )
        ],
        enum_values_to_rename=[]
    )

    # Drop document size column
    op.drop_column('document', 'document_size')
    op.drop_column('document_version', 'document_size')

    # Undo renaming file_name to name and document_type to type
    op.alter_column(
        'document',
        'document_name',
        new_column_name='file_name',
        existing_type=sa.VARCHAR(),
        nullable=False
    )
    op.alter_column(
        'document_version',
        'document_name',
        new_column_name='file_name',
        existing_type=sa.VARCHAR(),
        nullable=False
    )

    # ### end Alembic commands ###
