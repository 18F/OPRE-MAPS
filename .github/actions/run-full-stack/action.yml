name: Run Full Stack
description: Runs the full stack from the docker-compose.yml
runs:
  using: composite
  steps:

    - name: Check if env.TEST_ENV is set
      shell: bash
      run: |
        if [[ -z "${{ env.JWT_PRIVATE_KEY }}" ]]; then
          echo "secrets.JWT_PRIVATE_KEY is empty or not set!"
          exit 1
        else
          echo "secrets.JWT_PRIVATE_KEY is set."
        fi

    - name: Start Stack
      shell: bash
      run: |
        set -x
        export JWT_PRIVATE_KEY=${{ env.JWT_PRIVATE_KEY }}
        docker compose -f docker-compose.e2e.yml down -v
        docker compose -f docker-compose.e2e.yml up --build -d
