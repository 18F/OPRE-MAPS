name: New Dev Backend Build and Deploy

on:
  workflow_dispatch:
  push:
    branches:
      - cml/add-alembic-dev
    paths:
      - backend/**
      
env:
  # TERRAFORM_VERSION: "1.6.6"
  # TF_IN_AUTOMATION: "True"
  ENVIRONMENT: "dev"
  WORKING_DIR: "backend"
  DOCKER_FILE: "Dockerfile.data-tools-import"

jobs:
  deploy: 
    # needs: build

    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 #v4.1.1
      
      - name: Log in to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDS }}

      # - name: Run Azure CLI commands
      #   uses: azure/CLI@v1
      #   with:
      #     azcliversion: 2.30.0
      #     inlineScript: |
      #       az group list
      - name: Build and deploy Container App
        uses: azure/container-apps-deploy-action@v1
        with:
          containerAppName: opre-ops-dev-backend
          imageToDeploy: ghcr.io/hhs/opre-ops/ops-backend:unstable
